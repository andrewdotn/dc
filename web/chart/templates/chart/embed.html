<html>
  <head>
    <style type="text/css">
      @font-face {
          font-family: 'ChunkFiveRegular';
          src: url('/static/fonts/Chunkfive-webfont.eot');
          src: url('/static/fonts/Chunkfive-webfont.eot?#iefix') format('embedded-opentype'),
               url('/static/fonts/Chunkfive-webfont.woff') format('woff'),
               url('/static/fonts/Chunkfive-webfont.ttf') format('truetype'),
               url('/static/fonts/Chunkfive-webfont.svg#ChunkFiveRegular') format('svg');
          font-weight: normal;
          font-style: normal;
      }

      @font-face {
          font-family: 'OpenSansRegular';
          src: url('/static/fonts/OpenSans-Regular-webfont.eot');
          src: url('/static/fonts/OpenSans-Regular-webfont.eot?#iefix') format('embedded-opentype'),
               url('/static/fonts/OpenSans-Regular-webfont.woff') format('woff'),
               url('/static/fonts/OpenSans-Regular-webfont.ttf') format('truetype'),
               url('/static/fonts/OpenSans-Regular-webfont.svg#OpenSansRegular') format('svg');
          font-weight: normal;
          font-style: normal;
      }

      @font-face {
          font-family: 'OpenSansBold';
          src: url('/static/fonts/OpenSans-Bold-webfont.eot');
          src: url('/static/fonts/OpenSans-Bold-webfont.eot?#iefix') format('embedded-opentype'),
               url('/static/fonts/OpenSans-Bold-webfont.woff') format('woff'),
               url('/static/fonts/OpenSans-Bold-webfont.ttf') format('truetype'),
               url('/static/fonts/OpenSans-Bold-webfont.svg#OpenSansBold') format('svg');
          font-weight: normal;
          font-style: normal;
      }

      h1 {
        margin-top:8px;
        margin-left:8px;
        margin-right:8px;
        margin-bottom:0px;
        color: #3E679F;
        font: 200%/125% 'ChunkFiveRegular', verdana, sans-serif;
      }

      #panelContainer { width:0; left:0; top:450px; position:absolute; overflow:hidden; background:#333; opacity:0; z-index:2 }
      #panelContainer h1 { font-size:20px; height:30px; background-color:#000; color:#eee; padding:10px 0 0 10px; margin-bottom:10px; cursor:pointer }
      #panelContainer ul { list-style:none; margin-top:0px; margin-bottom:20px; padding-left:10 }
      #panelContainer ul li { margin:0; padding:0 0 2px 0; cursor:pointer; font-family:Verdana; }
      #panelContainer a { color:#fff; text-decoration:none }
      #panelContainer #panel { margin-left:-175px }
      #panelContainer #panel a:hover {text-decoration:underline }
      #panelContainer #panel li img { vertical-align:text-bottom; padding-right: 5px; }

      #showPanel { position:absolute; z-index:2; left:0; top:500px; padding-top:0px; width:0px; height:100px; cursor:pointer; margin-left:0 }
      #showPanel span { display:block; font-size:20px; height:30px; padding:10px 0 10px 10px; width:100px; color:#fff; background:#333 }

      #embeddiv { top:100px; left:50px; padding: 10px; border: 2px solid; background-color: #eee;  z-index:2 }
      #embeddiv a { color: #000; text-decoration:none; }
      #embeddiv a:hover { text-decoration:underline; }

      #linkdiv { top:100px; left:50px; padding: 10px; border: 2px solid; background-color: #eee;  z-index:2 }
      #linkdiv a { color: #000; text-decoration:none; }
      #linkdiv a:hover { text-decoration:underline; }
    </style>

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="/static/highcharts.js"></script>
{% ifequal user.username "admin" %}
    <script type="text/javascript" src="/static/modules/exporting.js"></script>
{% endifequal %}

    <script type="text/javascript">
      var addthis_config = {
        services_exclude: "twitter,facebook",
        data_track_clickback: false,
        ui_click: true
      };
      var addthis_share = {
        title: "{{ chart.title|escapejs }}",
        url: "{{ url|escapejs }}",
        description: "{{ chart.description|escapejs }}"
      }
    </script>
    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4db065a4597e8114"></script>

    <script type="text/javascript">
      //
      // supportsVml and supportsSVG thanks to http://stackoverflow.com/questions/654112/how-do-you-detect-support-for-vml-or-svg-in-a-browser
      //

      function supportsVml() {
          if (typeof supportsVml.supported == "undefined") {
              var a = document.body.appendChild(document.createElement('div'));
              a.innerHTML = '<v:shape id="vml_flag1" adj="1" />';
              var b = a.firstChild;
              b.style.behavior = "url(#default#VML)";
              supportsVml.supported = b ? typeof b.adj == "object": true;
              a.parentNode.removeChild(a);
          }
          return supportsVml.supported
      }

      function supportsSVG() {
        return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1")
      }

      function renderDynamicChart() {
        var chart = new Highcharts.Chart({
          chart: {
            renderTo: 'chartdiv',
            defaultSeriesType: 'line'
          },
          credits: {
            text: ""
          },
          {{ chart.chart_settings|safe }}
{% ifequal user.username "admin" %}
          exporting: {url: "/chart/convert/{{ chart.id|safe }}/"},
{% endifequal %}
          series: [ {{ chart.chart_data|safe }} ]
        });
      }

      function renderStaticImage() {
        $("#chartdiv".append('<h2><p align="center">{{ chart.title|safe }}</p></h2>'));
        $("#chartdiv".append('<a href="/chart/{{ chart.id|safe }}" target="_blank"><img src="/chart/image/{{ chart.id|safe }}" alt="{{ chart.title|safe }}"/></a>'));
      }

      function showPanel() {
        $("#panel").animate({marginLeft:"0px"}, 400 );
        $("#panelContainer").animate({width:"175px", opacity:1}, 400 );
        $("#showPanel").animate({width:"0px", opacity:0}, 600).hide("slow");
      }

      function hidePanel() {
        $("#panel").animate({marginLeft:"-175px"}, 500 );
        $("#panelContainer").animate({width:"0px", opacity:0}, 400 );
        $("#showPanel").show("normal").animate({width:"28px", opacity:1}, 200);
      }

      function centerPopupDiv(div) {
        div.css("top", (($(window).height() - div.outerHeight()) / 2) + $(window).scrollTop() + "px");
        div.css("left", (($(window).width() - div.outerWidth()) / 2) + $(window).scrollLeft() + "px");
      }

      function showEmbedPopup() {
        var div = $("#embeddiv");

        centerPopupDiv(div);
        div.fadeIn();

        $("#embeddiv textarea").select();
      }

      function hideEmbedPopup() {
        $("#embeddiv").fadeOut();
      }

      function showLinkPopup() {
        var div = $("#linkdiv");

        centerPopupDiv(div);
        div.fadeIn();

        $("#linkdiv textarea").select();
      }

      function hideLinkPopup() {
        $("#linkdiv").fadeOut();
      }

      $(document).ready(function() {
        $("#panel #title").click(function() {
          hidePanel();
        });

        $("#showPanel").click(function() {
          showPanel();
        });

        $("#embed").click(function() {
          showEmbedPopup();
          hidePanel();
        });

        $("#link").click(function() {
          showLinkPopup();
          hidePanel();
        });

        $("#facebook").click(function() {
          window.open("https://www.facebook.com/sharer.php?u={http://d4t4.org/{{ chart.sparkblocks }}&t={{ chart.title }}");
          hidePanel();
        });

        $("#twitter").click(function() {
          window.open("https://twitter.com/share?url=&text={{ chart.tweet }}&via=_datacollective&related=_datacollective");
          hidePanel();
        });

        if (supportsVml() || supportsSVG()) {
          renderDynamicChart();
        }
        else {
          renderStaticImage();
        }
      });
    </script>
  </head>

  <body>
    <h1 align="left">{{ chart.title }}</h1>
{% if chart.html_below_title %}
    <p align="left" style='margin-top:8px; margin-left:8px; margin-right:8px; font-family:Georgia'>{{ chart.html_below_title|safe }}</p>
{% endif %}
{% if chart.y_axis_description %}
    <p align="left" style='margin-top:8px; margin-left:8px; margin-right:8px; color:#888888; font-family:ChunkFiveRegular; font-size:75%'>{{ chart.y_axis_description|safe }}</p>
{% endif %}

    <div id="chartdiv">
      <noscript>
        <a href="/chart/{{ chart.id|safe }} "target="_blank"><img src="/chart/image/{{ chart.id|safe }}" alt="{{ chart.title|safe }}"/></a>
      </noscript>
    </div>

    <div id="panelContainer">
      <div id="panel">
        <h1 id="title">&laquo; Share</h1>
        <ul>
          <li id="embed"><a href="#" style="padding-left:21px;">embed code</a></li>
          <li id="link"><a href="#" style="padding-left:21px;">link</a></li>
          <li id="facebook"><img src="/static/images/facebook.gif"><a href="#">facebook</a></li>
          <li id="twitter"><img src="/static/images/twitter.gif"><a href="#">twitter</a></li>
          <li id="addthis">
            <div class="addthis_toolbox addthis_default_style addthis_16x16_style">
              <a class="addthis_button_compact" onmouseover="void(0);">other</a>
            </div>
          </li>
        </ul>
      </div>
    </div>

    <h1 id="showPanel"><span>Share &raquo;</span></h1>

    <div id="creditsdiv" style="font-family:Georgia; margin-left:50px; width:525px; font-size: 85%; color:#888888; text-align:left; float:left">
      <b>Sources</b>: {{chart.source_title|safe}}.  For complete source data, credits and more, <a target="_blank" href="/chart/{{ chart.short_name|safe }}">click here</a>.
    </div>

    <div id="embeddiv" style="position:absolute; display:none">
      <textarea rows="2" cols="50">&lt;iframe src="http://{{ host }}/chart/embed/{{ chart.id|safe }}" width="630" height="670" frameborder="0"&gt;&lt;/iframe&gt;</textarea>
      <div><a href="#" onclick="hideEmbedPopup();">close</a></div>
    </div>

    <div id="linkdiv" style="position:absolute; display:none">
      <textarea rows="1" cols="50">{{url|safe}}</textarea>
      <div><a href="#" onclick="hideLinkPopup();">close</a></div>
    </div>
  </body>
</html>
