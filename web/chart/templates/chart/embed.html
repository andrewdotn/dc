<html>
  <head>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.1/jquery.min.js"></script>
    <script type="text/javascript" src="/static/highcharts.js"></script>
{% ifequal user.username "admin" %}
    <script type="text/javascript" src="/static/modules/exporting.js"></script>
{% endifequal %}

    <script type="text/javascript">
      //
      // supportsVml and supportsSVG thanks to http://stackoverflow.com/questions/654112/how-do-you-detect-support-for-vml-or-svg-in-a-browser
      //

      function supportsVml() {
          if (typeof supportsVml.supported == "undefined") {
              var a = document.body.appendChild(document.createElement('div'));
              a.innerHTML = '<v:shape id="vml_flag1" adj="1" />';
              var b = a.firstChild;
              b.style.behavior = "url(#default#VML)";
              supportsVml.supported = b ? typeof b.adj == "object": true;
              a.parentNode.removeChild(a);
          }
          return supportsVml.supported
      }

      function supportsSVG() {
        return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure", "1.1")
      }

      function renderDynamicChart() {
        chart = new Highcharts.Chart({
          chart: {
            renderTo: 'chartdiv', 
            defaultSeriesType: 'line'
          },
          credits: {
            text: ""
          },
          {{ chart.chart_settings|safe }}

{% ifequal user.username "admin" %}
          exporting: {url: "/chart/convert/{{ chart.id|safe }}/"},
{% endifequal %}
          series: [ {{ chart.chart_data|safe }} ]
        });
      }
      
      function renderStaticImage() {
        $("#chartdiv".append('<h2><p align="center">{{ chart.title|safe }}</p></h2>'));
        $("#chartdiv".append('<a href="/chart/{{ chart.id|safe }}" target="_blank"><img src="/chart/image/{{ chart.id|safe }}" alt="{{ chart.title|safe }}"/></a>'));
      }

// Highcharts/Raphael can work on devices that have SVG or VML
// on other devices (such as all android 2.X devices), we must
// fall back to a static image.

      // if (supportsSVG() || supportsVml()) {
      //        document.write('<div id="chartdiv" style="margin:0px auto; max-width:600px; padding:8px; background-color:#ffffff; border:1px solid #aaaaaa "> </div>');      
      // } else {
      //        document.write('<h2><p align="center">Spending on Medicaid as a Percentage of Gross Domestic Product, 1966-2009</p></h2>');
      //        document.write('<a href="/chart/medicaid_vs_gdp"><img src="/chart/image/medicaid_vs_gdp" alt="Chart: Spending on Medicaid as a Percentage of Gross Domestic Product, 1966-2009"/></a>');
      // }


			var chart;

      $(document).ready(function() {
        if (supportsVml() || supportsSVG()) {
          renderDynamicChart();
        }
        else {
          renderStaticImage();
        }
      });
    </script>

    <style>
@font-face {
    font-family: 'ChunkFiveRegular';
    src: url('/static/fonts/Chunkfive-webfont.eot');
    src: url('/static/fonts/Chunkfive-webfont.eot?#iefix') format('embedded-opentype'),
         url('/static/fonts/Chunkfive-webfont.woff') format('woff'),
         url('/static/fonts/Chunkfive-webfont.ttf') format('truetype'),
         url('/static/fonts/Chunkfive-webfont.svg#ChunkFiveRegular') format('svg');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'OpenSansRegular';
    src: url('/static/fonts/OpenSans-Regular-webfont.eot');
    src: url('/static/fonts/OpenSans-Regular-webfont.eot?#iefix') format('embedded-opentype'),
         url('/static/fonts/OpenSans-Regular-webfont.woff') format('woff'),
         url('/static/fonts/OpenSans-Regular-webfont.ttf') format('truetype'),
         url('/static/fonts/OpenSans-Regular-webfont.svg#OpenSansRegular') format('svg');
    font-weight: normal;
    font-style: normal;
}

@font-face {
    font-family: 'OpenSansBold';
    src: url('/static/fonts/OpenSans-Bold-webfont.eot');
    src: url('/static/fonts/OpenSans-Bold-webfont.eot?#iefix') format('embedded-opentype'),
         url('/static/fonts/OpenSans-Bold-webfont.woff') format('woff'),
         url('/static/fonts/OpenSans-Bold-webfont.ttf') format('truetype'),
         url('/static/fonts/OpenSans-Bold-webfont.svg#OpenSansBold') format('svg');
    font-weight: normal;
    font-style: normal;
}

      h1 {
        margin-top:8px;
        margin-left:8px;
        margin-right:8px;
        margin-bottom:0px;
        color: #3E679F;
        font: 200%/125% 'ChunkFiveRegular', verdana, sans-serif;
      }
</style>
  </head>

  <body>
    <h1 align="left">{{ chart.title }}</h1>
{% if chart.html_below_title %}
    <p align="left" style='margin-top:8px; margin-left:8px; margin-right:8px; font-family:Georgia'>{{ chart.html_below_title|safe }}</p>
{% endif %}
{% if chart.y_axis_description %}
    <p align="left" style='margin-top:8px; margin-left:8px; margin-right:8px; color:#888888; font-family:ChunkFiveRegular; font-size:75%'>{{ chart.y_axis_description|safe }}</p>
{% endif %}
    
    <div id="chartdiv">
      <noscript>
        <a href="/chart/{{ chart.id|safe }} "target="_blank"><img src="/chart/image/{{ chart.id|safe }}" alt="{{ chart.title|safe }}"/></a>
      </noscript>
    </div>

    <div id="creditsdiv" style="font-family:Georgia; margin-left:50px; width:525px; font-size: 85%; color:#888888; text-align:left; float:left">
      <b>Sources</b>: {{chart.source_title|safe}}.  For complete source data, credits and more, <a target="_blank" href="/chart/{{ chart.short_name|safe }}">click here</a>.
    </div>
  </body>
</html>
